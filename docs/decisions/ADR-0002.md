# ADR-0002 — Dynamic Pricing Model

**Date:** October 18, 2025  
**Status:** Accepted  
**Context:** ShayrdAir MVP Development

---

## Context

ShayrdAir's core value proposition is making outdoor adventures more affordable through group economics. We needed a pricing system that:
1. Lowers per-person costs as more people join
2. Maintains guide margins at all group sizes
3. Displays transparently on the frontend
4. Integrates cleanly with Stripe Checkout
5. Enables automatic savings redistribution when new participants join

---

## Decision

Implement dynamic group-pricing through the `pricing_tiers` table, where each experience has explicit party-size tiers.

**Schema:**
```sql
CREATE TABLE pricing_tiers (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  experience_id UUID NOT NULL REFERENCES experiences(id),
  party_size INT NOT NULL,
  price_per_person NUMERIC(10,2) NOT NULL,
  label TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(experience_id, party_size)
);
```

**Example Data:**
| experience_id | party_size | price_per_person | label |
|---------------|------------|------------------|-------|
| abc-123       | 1          | 700.00           | Solo  |
| abc-123       | 2          | 600.00           | Duo   |
| abc-123       | 3          | 500.00           | Small Group |
| abc-123       | 4          | 450.00           | Standard |

---

## Rationale

**Why this design:**

1. **Transparency:** Exact prices for each group size are clear to customers upfront
2. **Scalability:** Each guide can define their own pricing tiers per experience
3. **Stripe Integration:** Price is deterministic based on party_size selection
4. **Query Performance:** Single lookup: `WHERE experience_id = X AND party_size = Y`
5. **Business Logic Enforcement:** Unique constraint prevents duplicate tiers

**Alternatives considered:**

**Option A: Formula-based pricing**
```sql
-- Price = base_price - (party_size * discount_step)
experiences.price_base = 700
experiences.price_step = 50
```
**Rejected:** Less flexible (can't do non-linear pricing), harder for guides to configure

**Option B: Hardcoded tiers in application logic**
**Rejected:** Not data-driven, requires code changes for new tiers

**Option C: Stripe Products + Prices**
**Rejected:** Vendor lock-in, slow API calls, doesn't match domain model

---

## Consequences

### Positive
- Simple query fetches all tiers for an experience
- Deterministic price based on user selection
- Can show "You save $X vs. solo booking"
- Guides can customize pricing per experience
- Easy analytics on which party sizes convert best

### Negative
- Stripe webhook complexity: must recalculate savings/refunds when new participants join
- Data entry overhead: guides must configure tiers vs. just entering two numbers
- Validation required: ensure no gaps in party sizes

---

## Implementation Notes

**Frontend (Wized):**
```javascript
// Fetch pricing tiers
const tiers = await supabase
  .from('pricing_tiers')
  .select('*')
  .eq('experience_id', experienceId)
  .order('party_size', { ascending: true });

// Calculate savings
const soloPrice = tiers.find(t => t.party_size === 1)?.price_per_person || 0;
const selectedPrice = tiers.find(t => t.party_size === partySize)?.price_per_person || 0;
const savings = (soloPrice - selectedPrice) * partySize;
```

**Stripe Integration:**
```javascript
// Create Checkout Session
const tier = await supabase
  .from('pricing_tiers')
  .select('*')
  .eq('experience_id', experienceId)
  .eq('party_size', partySize)
  .single();

const session = await stripe.checkout.sessions.create({
  line_items: [{
    price_data: {
      currency: 'usd',
      unit_amount: Math.round(tier.price_per_person * 100),
      product_data: {
        name: `${experience.title} - Party of ${partySize}`,
      },
    },
    quantity: partySize,
  }],
  mode: 'payment',
  success_url: `${domain}/booking/success?session_id={CHECKOUT_SESSION_ID}`,
});
```

---

## Related Documents

- [SCHEMA.md](../../db/schema/SCHEMA.md) — Full database schema
- [ADR-0001](./ADR-0001.md) — Tech stack selection
- [architecture.md](../architecture.md) — System architecture

---

**Decision Maker:** Tim Donovan (Founder)  
**Reviewers:** Claude Code, GPT-5 (AI validation)  
**Last Reviewed:** December 2025